**Resumo da Aula: Camadas, Cache e Comandos no Docker**  

---

### **1. Camadas no Docker**  
- **O que s√£o?**  
  - Fazem parte do sistema de armazenamento do Docker.  
  - Cada instru√ß√£o no `Dockerfile` (ex: `COPY`, `RUN`, `WORKDIR`) gera uma **camada imut√°vel** (n√£o fazemos altera√ß√µes nas camadas, mas sim substitui√ß√µes por inteiro).
  - Camadas s√£o armazenadas em cache e reutilizadas para builds futuros, acelerando o processo.  
  - Exemplo:  
    ```dockerfile  
    FROM node:20-alpine          # Camada 1: Imagem base  
    WORKDIR /app                # Camada 2: Define diret√≥rio  
    COPY package.json ./        # Camada 3: Copia arquivos  
    RUN pnpm install            # Camada 4: Instala depend√™ncias  
    ```  

- **Como visualizar?**  
  Use `docker history <imagem>` para ver as camadas e seus tamanhos:  
  ```bash  
  docker history widget-server:v1  
  ```  

---

### **2. Mecanismo de Cache**  
- **Como funciona?**  
  - O Docker reutiliza camadas existentes se nenhuma altera√ß√£o for detectada nas instru√ß√µes anteriores.  
  - Se uma instru√ß√£o muda, todas as camadas subsequentes s√£o reconstru√≠das.  

- **Exemplo de cache em a√ß√£o:**  
  ```bash  
  # Primeiro build (sem cache)  
  docker build -t widget-server:v1 .  

  # Build subsequente (usa cache)  
  docker build -t widget-server:v1 .  # Mais r√°pido!  
  ```  

- **Quando o cache √© invalidado?**  
  - Altera√ß√µes no `Dockerfile`.  
  - Mudan√ßas em arquivos copiados (ex: `package.json`).  

---

### **3. Comandos: CMD vs ENTRYPOINT**  
| **CMD**                          | **ENTRYPOINT**                  |  
|----------------------------------|----------------------------------|  
| Define o comando padr√£o para executar o container. | Define o execut√°vel principal (n√£o substitu√≠vel). |  
| Pode ser sobrescrito no `docker run`. | Par√¢metros do `docker run` s√£o adicionados ao ENTRYPOINT. |  
| **Exemplo**:                     | **Exemplo**:                    |  
| ```dockerfile                    | ```dockerfile                   |  
| CMD ["node", "dist/server.mjs"]  | ENTRYPOINT ["node"]             |  
| ```                              | CMD ["dist/server.mjs"]         |  
|                                  | ```                             |  

---

### **4. Volumes e Efemeridade**  
- **Containers s√£o ef√™meros**: Dados gerados durante a execu√ß√£o (ex: arquivos tempor√°rios) s√£o perdidos se o container for removido.  
- **Solu√ß√£o**: Use **volumes** para persistir dados:  
  ```bash  
  docker run -v /caminho/local:/caminho/container widget-server:v1  
  ```  

---

### **5. Melhores Pr√°ticas**  
1. **Ordene instru√ß√µes no `Dockerfile`**:  
   - Coloque instru√ß√µes menos frequentes (ex: `COPY package.json`) no topo para maximizar o cache.  
2. **Use `.dockerignore`**:  
   - Ignore arquivos desnecess√°rios (ex: `node_modules`, `.env`).  
3. **Minimize camadas**:  
   - Combine comandos com `&&` (ex: `RUN apt update && apt install -y curl`).  

---

### **6. Inspe√ß√£o de Camadas**  
- **Comando**:  
  ```bash  
  docker inspect <container_id>  # Detalhes t√©cnicos do container  
  docker image inspect <imagem>  # Informa√ß√µes da imagem  
  ```  

---

**Por Que Isso Importa?**  
- **Efici√™ncia**: Builds mais r√°pidos com cache.  
- **Controle**: Entender camadas ajuda a otimizar o tamanho da imagem.  
- **Seguran√ßa**: Camadas imut√°veis reduzem riscos de altera√ß√µes indesejadas.  

üëâ **Dica Pr√°tica**:  
*"Pense nas camadas como blocos de Lego: reuse o que n√£o mudou e reconstrua apenas o necess√°rio!"*  

**Pr√≥ximos Passos**:  
- Aula sobre **seguran√ßa** (varredura de vulnerabilidades com `docker scan`).  
- Uso de **usu√°rios n√£o-root** em containers para mitigar riscos. üõ°Ô∏è