**Resumo da Aula: Cria√ß√£o de um Dockerfile para uma Aplica√ß√£o Node.js**  

---

### **Objetivo da Aula**  
Configurar um **Dockerfile** para containerizar uma aplica√ß√£o Node.js, utilizando o Docker e abordando desde a escolha da imagem base at√© a execu√ß√£o da aplica√ß√£o em ambiente isolado.  

---

### **Principais Etapas e Conceitos**
1. **Dockerfile**  
   √â um arquivo declarativo. Ou seja, n√≥s declaramos o que queremos fazer e dentro dele teremos basicamente todas as instru√ß√µes para criar o nosso container.

2. **Base Image (Imagem Base)**  
   - **Escolha**: Utilizar a imagem oficial `node:20-bookworm` do Docker Hub, que inclui Node.js e npm pr√©-instalados.  
   - **Motivo**: Garantir compatibilidade e evitar configura√ß√µes manuais do ambiente.  
   - **Exemplo**:  
     ```dockerfile  
     FROM node:20-bookworm  
     ```  

3. **Instala√ß√£o de Depend√™ncias Globais**  
   - **PNPM**: Instalar o gerenciador de pacotes `pnpm` globalmente via npm:  
     ```dockerfile  
     RUN npm install -g pnpm  
     ```  

4. **Configura√ß√£o do Diret√≥rio de Trabalho**  
   - Criar e definir o diret√≥rio `/app` como padr√£o:  
     ```dockerfile  
     WORKDIR /app  
     ```  

5. **C√≥pia de Arquivos de Depend√™ncia**  
   - Copiar `package.json` e `pnpm-lock.yaml` para instala√ß√£o eficiente:  
     ```dockerfile  
     COPY package.json pnpm-lock.yaml ./  
     ```  

6. **Instala√ß√£o de Depend√™ncias do Projeto**  
   - Executar `pnpm install` para instalar depend√™ncias:  
     ```dockerfile  
     RUN pnpm install  
     ```  

7. **C√≥pia do C√≥digo-Fonte**  
   - Transferir toda a aplica√ß√£o para o container:  
     ```dockerfile  
     COPY . .  
     ```  

8. **Vari√°veis de Ambiente**  
   - Definir vari√°veis necess√°rias (ex: porta e URL de servi√ßos externos):  
     ```dockerfile  
     ENV PORT=3333  
     ENV CLOUDFLARE_PUBLIC_URL=http://localhost:3333  
     ```  

9. **Exposi√ß√£o de Portas**  
   - Liberar a porta `3333` para acesso externo:  
     ```dockerfile  
     EXPOSE 3333  
     ```  

10. **Execu√ß√£o da Aplica√ß√£o**  
   - Comando para iniciar o servidor em modo de desenvolvimento:  
     ```dockerfile  
     CMD ["pnpm", "run", "dev"]  
     ```  

---

### **Comandos Docker Utilizados**  
1. **Construir a Imagem**:  
   ```bash  
   docker build -t widget-server:v1 .  
   ```  
   - `-t`: Define o nome e a tag da imagem.  
   - `.`: Indica o diret√≥rio do Dockerfile.  

2. **Executar o Container**:  
   ```bash  
   docker run -p 3333:3333 widget-server:v1  
   ```  
   - `-p`: Mapeia a porta do host para a porta do container.  

---

### **Solu√ß√£o de Problemas**  
- **Erro "pnpm not found"**:  
  - **Causa**: A imagem base n√£o inclui o `pnpm`.  
  - **Solu√ß√£o**: Instalar o `pnpm` globalmente via `npm install -g pnpm` no Dockerfile.  

---

### **Boas Pr√°ticas Destacadas**  
1. **Escolha de Imagens Leves**:  
   - Optar por vers√µes "slim" (ex: `node:20-alpine`) em produ√ß√£o para reduzir o tamanho da imagem.  
2. **Cache de Camadas**:  
   - Copiar primeiro os arquivos de depend√™ncia (`package.json` e `pnpm-lock.yaml`) para aproveitar o cache durante rebuilds.  
3. **Multi-Stage Builds (Futuro)**:  
   - Separar etapas de build e runtime para otimizar a imagem final.  

---

### **Fluxo Completo do Dockerfile**  
```dockerfile  
FROM node:20-bookworm  

RUN npm install -g pnpm  

WORKDIR /app  

COPY package.json pnpm-lock.yaml ./  
RUN pnpm install  

COPY . .  

ENV PORT=3333  
ENV CLOUDFLARE_PUBLIC_URL=http://localhost:3333  

EXPOSE 3333  

CMD ["pnpm", "run", "dev"]  
```  

---

### **Pr√≥ximos Passos (Spoiler)**  
- **Multi-Stage Builds**: Reduzir o tamanho da imagem removendo depend√™ncias desnecess√°rias ap√≥s o build.  
- **Vari√°veis de Ambiente Din√¢micas**: Utilizar `docker-compose` ou argumentos (`--env-file`) para maior flexibilidade.  
- **Deploy na Nuvem**: Integra√ß√£o com servi√ßos como AWS ECS ou Kubernetes.  

---

**Conclus√£o**  
O Dockerfile criado encapsula toda a configura√ß√£o necess√°ria para executar a aplica√ß√£o Node.js em um ambiente isolado. A aula refor√ßa a import√¢ncia de:  
- Escolher imagens base adequadas.  
- Gerenciar depend√™ncias de forma eficiente.  
- Utilizar vari√°veis de ambiente para configura√ß√£o din√¢mica.  

üëâ **Dica Final**:  
*"Containerizar √© como preparar uma mala de viagem: inclua apenas o essencial e garanta que tudo funcione em qualquer destino (ambiente)!"* üß≥üöÄ